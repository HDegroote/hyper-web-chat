<app>
    <nav class="uk-navbar-container uk-navbar-transparent" uk-navbar>
        <div class="uk-navbar-left uk-margin-small-top uk-margin-left">
            <a href="#" uk-tooltip="channel deets" uk-toggle="#channal-list">
                <i uk-icon="icon:list;"></i>
                <b class="channelname">{state.channelName}</b>
            </a>
        </div>
        <div class="uk-navbar-right">
            <ul class="uk-iconnav">
                <li class="uk-margin-right">
                    <a href="#" style="margin-top:13px" uk-icon="icon: users;" uk-tooltip="user deets"
                        uk-toggle="#user-list"></a>
                </li>
                <li class="uk-margin-right">
                    <a href="#" style="margin-top:13px" uk-icon="icon: world;" uk-tooltip="browser"
                    uk-toggle="#terminal"></a>
                </li>
            </ul>
        </div>
        <div class="uk-navbar-right">
            <ul class="uk-iconnav">
                <li class="uk-margin-right">
                </li>
            </ul>
        </div>
    </nav>
    <messages channel={state.channelName} messages={state.messages[state.channelName]} emit={emit}></messages>
    <channellist channels={state.channels} emit={emit}></channellist>
    <userlist name={state.name}></userlist>
    <terminal></terminal>
    <script>
        export default {
            state:{messages:{}},
            actions:window.actions,
            emit:(action, input='') => {
                return new Promise((res)=>{
                    if(socket.readyState === WebSocket.CONNECTING) {
                        console.log('not connected, waiting');
                        window.socket.addEventListener('open', (event) => {
                            res(socket.send(sign({ action, input, keyPair })));
                        });
                    } else res(socket.send(sign({ action, input, keyPair })));

                })
                
            },
            onMounted() {
                socket.onmessage = async function (event) {
                    var arrayBuffer = await event.data.arrayBuffer();
                    var buffer = Buffer.from(arrayBuffer);
                    const message = packr.unpack(buffer);
                    console.log(message)
                    if(typeof this.actions[message.action] == 'function') actions[message.action].bind(this)(message.i);
                }.bind(this);
                this.emit('getChannels')
                this.emit('getProfile')
                
            }
        }
    </script>
</app>